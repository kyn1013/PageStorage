<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>히스토리 상세 조회</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap');
        .do-hyeon-regular {
            font-family: "Do Hyeon", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        body {
            font-family: "Do Hyeon", sans-serif;
            font-weight: 400;
            font-style: normal;
            display: flex;
            margin: 0; /* 여백 제거 */
            padding: 0; /* 여백 제거 */
        }

        .content {
            flex-grow: 1; /* 나머지 공간 모두 사용 */
            padding-top: 40px;
            padding-bottom: 40px;
            padding-left: 80px; /* 왼쪽 패딩 */
            padding-right: 80px; /* 오른쪽 패딩 */
            margin-left: 250px; /* 사이드바 너비만큼 왼쪽 여백 */
            overflow: auto; /* 내용이 넘칠 경우 스크롤바 생성 */
        }

        .sidebar {
            width: 200px;
            height: 100vh;
            background-color: #f0f0f0;
            padding: 20px;
            position: fixed;
        }

        .history-image {
            /*margin-right: 20px;*/
            margin-top: 10px;
            margin-left: 180px; /* 왼쪽 여백 추가 */
            width: 400px; /* 이미지 크기 조정 */
            height: 400px; /* 이미지 크기 조정 */
            border-radius: 20%; /* 이미지를 원형으로 만듦 */
            object-fit: cover;
        }

        .history-writer {
            padding-left: 20px;
            padding-right: 20px;
            padding-bottom: 10px;
            padding-top: 10px;
            background-color: #A281C3;
            font-style: italic;
            color: #E6EAF4;
            border-radius: 40px;
            display: inline-block;
        }

        .time {
            text-align: right; /* 텍스트를 오른쪽 정렬 */
            border-radius: 40px;
            padding-left: 8px;
            padding-right: 8px;

            background-color: #A281C3;
            font-style: italic;
            color: #E6EAF4;

            /*display: inline-block;*/
            float: right; /* 오른쪽으로 정렬 */
            /*line-height: 1.2; !* 줄 간격 조정 *!*/
            height: auto; /* 높이를 자동으로 설정하여 내용에 맞춤 */
        }


        .writer-image {
            width: 50px; /* 이미지 크기 조정 */
            height: 50px; /* 이미지 크기 조정 */
            border-radius: 50%; /* 이미지를 원형으로 만듦 */
            object-fit: cover; /* 이미지 비율을 유지하면서 요소에 맞춤 */
            margin-right: 10px; /* 텍스트와의 여백 설정 */
        }

        .bookname {
            padding: 10px;
            margin-top: 30px; /* 등록시간과의 간격 설정 */
        }

        .history-text {
            flex: 1;
        }

        .inline-icon {
            width: 27px;
            height: 27px;
            display: inline-block;
            vertical-align: middle;
        }

        .inline-text {
            display: inline-block;
            vertical-align: middle;
            margin-left: 30px;
            font-size: 1.1em;
        }

        .inline-text-difficulty {
            display: inline-block;
            vertical-align: middle;
        }

        .subtitle-label {
            font-size: 1.4em; /* "책 추천인:" 텍스트의 글씨 크기 증가 */
        }


        #nickname {
            float: right;
        }

        #profile {
            float: left;
        }

        #blank {
            color: white;
        }

        #aaa {
            float: right;
        }

        a {
            display: block;
            margin-bottom: 10px;
            text-decoration: none;
            color: black;
        }

        .history_content > * {
            margin-bottom: 10px; /* 각 요소 간의 간격 설정 */
        }
    </style>
</head>
<body>
<div th:replace="~{sidebar :: sidevarFragment}"></div>

<div class="content">
    <div class="history-writer">
        <div id="profile">
            <!-- 사용자 이미지가 존재하는 경우 -->
            <img th:if="${history.getProfileImage() != null}"
                 th:src="@{/profileImage/{imageFile}(imageFile=${history.getProfileImage()})}"
                 alt="사용자 지정 프로필 이미지"
                 class="writer-image"/>
            <!-- 사용자 이미지가 존재하지 않는 경우 -->
            <img th:unless="${history.getProfileImage() != null}"
                 th:src="@{/image/nn.jpeg}"
                 alt="기본프로필 이미지"
                 class="writer-image"/>
        </div>
        <div id="nickname"><p><span th:text="${history.memberNickname}">작성자 이름</span></p></div>
    </div>

    <div class="history_content">

        <div class="time">
            <h4> <span th:text="${#temporals.format(history.createdDate, 'yyyy-MM-dd HH:mm')}"></span></h4>
        </div>

        <div id="blank">
            여백용
        </div>

        <p class="subtitle-label"><img th:src="@{/image/bookicon.png}" alt="책 이미지" class="inline-icon">
            <span th:text="${history.bookName}" class="inline-text-difficulty">책제목</span></p>

        <p class="subtitle-label"><img th:src="@{/image/phrase.png}" alt="책 이미지" class="inline-icon">
            인상깊은 구절 </p>
        <div th:with="quotedPhrase='&quot;' + ${history.phrase} + '&quot;'">
            <div class="inline-text" th:text="${quotedPhrase}"></div>
        </div>


        <p class="subtitle-label"><img th:src="@{/image/difficulty.png}" alt="책 이미지" class="inline-icon">
            독서 난이도 : <span th:text="${history.difficulty}" class="inline-text-difficulty"></span></p>

        <p class="subtitle-label"><img th:src="@{/image/applicationToLife.png}" alt="책 이미지" class="inline-icon">
            삶에 적용할 점</p>
        <span th:text="${history.applicationToLife}" class="inline-text"></span>

        <p class="subtitle-label"><img th:src="@{/image/bookRecommender.png}" alt="책 이미지" class="inline-icon">
            이 책을 추천하고 싶은 사람</p>
        <div class="inline-text" th:text="${history.bookRecommender}"></div>

        <p class="subtitle-label"><img th:src="@{/image/historyContent.png}" alt="책 이미지" class="inline-icon">
            기록</p>
        <div th:text="${history.historyContent}" class="inline-text"></div>



        <div class="history-image">
            <img th:src="@{/historyImage/{imageFile}(imageFile=${history.getHistoryImage()})}" alt="히스토리 이미지" class="history-image"/>
        </div>

        <h3>태그</h3>
        <ul>
            <li th:each="tagName : ${history.tagNames}" th:text="${tagName}"></li>
        </ul>
        <h3>추출된 핵심 키워드</h3>
        <ul class="keyword-list" id="keywords">
            <li th:each="keyword : ${history.keywords}" th:text="${keyword}">#키워드명</li>
        </ul>
    </div>

    <div class="my-3">
        <a th:href="@{|/histories/update/${history.historySeq}|}" class="btn btn-sm btn-outline-secondary"
           th:if="${ userNickName == history.memberNickname}"
           th:text="수정"></a>
    </div>

    <div class="my-3">
        <a th:href="@{|/histories/delete/${history.historySeq}|}" class="btn btn-sm btn-outline-secondary"
           th:if="${ userNickName == history.memberNickname}"
           th:text="삭제"></a>
    </div>


    <hr/>

    <h3>댓글</h3>
    <h5 th:text="|${#lists.size(history.comments)}개의 답변이 있습니다.|"></h5>
    <div>
        <ul th:each="realComments : ${realComment}">
            <li th:text="|${realComments.content} - 글쓴이: ${realComments.memberName}|"></li>
            <a th:href="@{|/comments/delete/${realComments.getCommentSeq()}|}" class="btn btn-sm btn-outline-secondary"
               th:if="${ userNickName == history.memberNickname}"
               th:text="삭제"></a>
        </ul>
    </div>

    <form th:action="@{|/comments/create/${history.historySeq}|}" th:object="${commentForm}" method="post">
        <div class="alert alert-danger" role="alert" th:if="${#fields.hasAnyErrors()}">
            <div th:each="err : ${#fields.allErrors()}" th:text="${err}" />
        </div>
        <textarea th:field="*{content}" rows="15"></textarea>
        <input type="submit" value="답변등록">
    </form>
</div>

</body>
</html>
